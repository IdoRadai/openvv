<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="includes/css/main.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="includes/css/viewability.css" type="text/css" />
	
    <script src="flowplayer/flowplayer-3.2.13.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

    <script src="scripts/viewability.js" type="text/javascript"></script>
    <script src="scripts/purl.js" type="text/javascript"></script>

    <title>OpenVV Viewability Test</title>
<head></head>

<body>

<div id="wrapper">
    <div id="player"></div>
</div>

<div id="debug_window" class='chip_shadow'> <span class='chip_title'>Move Player</span><br />
    <table width="100%" align="center" cellpadding="1" cellspacing="0" class="chip_stats">
        <tr>
            <td class="chip_title">Top:</td>
            <td class="chip_stat_number"><input id="setTop" name="setTop" type="text" size="3" maxlength="4" /></td>
        </tr>
        <tr>
            <td class="chip_title">Left:</td>
            <td class="chip_stat_number"><input id="setLeft" name="setLeft" type="text" size="3" maxlength="4" /></td>
        </tr>
        <tr>
            <td class="chip_title">Width:</td>
            <td class="chip_stat_number"><input id="setWidth" name="setWidth" type="text" size="3" maxlength="4" /></td>
        </tr>
        <tr>
            <td class="chip_title">Height:</td>
            <td class="chip_stat_number"><input id="setHeight" name="setHeight" type="text" size="3" maxlength="4" /></td>
        </tr>
        <tr>
            <td class="chip_title">AutoPlay:</td>
            <td class="chip_stat_number"><input id="setAutoPlay" name="setAutoPlay" type="checkbox" size="3" /></td>
        </tr>
        <tr>
            <td class="chip_title"> </td>
            <td class="chip_stat_number"><button onclick="DVAdReload()">Reload</button></td>
        </tr>
    </table>
</div>


<div id="ovvParamValues" class="chip chip_shadow ovvParamBox dragbox">
<button type="button" class="close">&times;</button>
<h2>OVV Viewability data</h2>

<div><label>Ad Width</label> <span data-ovv="adWidth"></span></div>
<div><label>Ad Height</label> <span data-ovv="adHeight"></span></div>
<div><label>Viewport Width</label> <span data-ovv="viewportWidth"></span></div>
<div><label>Viewport Height</label> <span data-ovv="viewportHeight"></span></div>
<hr class="light" />
<div><label>Viewable</label> <span data-ovv="percentViewable"></span></div>
<div><label>Window Focus</label> <span data-ovv="windowActive"></span></div>

</div>


<div id='chip' class='xchip chip_shadow' style="display:none;"> <span class='chip_title'>VIEWABILITY</span>
    <div id='chip_events' class='chip_section'> </div>
    <div class='chip_section'>
        <table width="100%" align="center" cellpadding="3" cellspacing="0" class="chip_stats">
            <tr>
                <td class="chip_stat_title">Ad Width:</td>
                <td class="chip_stat_number" id="chip_adWidth">---</td>
                <td>&nbsp;</td>
                <td class="chip_stat_title">objTop:</td>
                <td class="chip_stat_number" id="chip_objTop">---</td>
            </tr>
            <tr>
                <td class="chip_stat_title">Ad Height:</td>
                <td class="chip_stat_number" id="chip_adHeight">---</td>
                <td>&nbsp;</td>
                <td class="chip_stat_title">objLeft:</td>
                <td class="chip_stat_number" id="chip_objLeft">---</td>
            </tr>
            <tr>
                <td class="chip_stat_title">Viewport Width:</td>
                <td class="chip_stat_number"id="chip_viewportWidth">---</td>
                <td>&nbsp;</td>
                <td class="chip_stat_title">objRight:</td>
                <td class="chip_stat_number" id="chip_objRight">---</td>
            </tr>
            <tr>
                <td class="chip_stat_title">Viewport Height:</td>
                <td class="chip_stat_number"id="chip_viewportHeight">---</td>
                <td>&nbsp;</td>
                <td class="chip_stat_title">objBottom:</td>
                <td class="chip_stat_number" id="chip_objBottom">---</td>
            </tr>
            <tr>
                <td class="chip_stat_title">Window Active:</td>
                <td class="chip_stat_number"id="chip_windowActive">---</td>
                <td>&nbsp;</td>
                <td class="chip_stat_title">IFrame:</td>
                <td class="chip_stat_number" id="chip_iFrame">---</td>
            </tr>
            <tr>
                <td class="chip_stat_title">Muted:</td>
                <td class="chip_stat_number"id="chip_isMuted">---</td>
                <td>&nbsp;</td>
                <td class="chip_stat_title">Viewability:</td>
                <td class="chip_stat_number" id="chip_view">---</td>
            </tr>
        </table>
    </div>
</div>

<button type="button" class="close"></button>
<!-- https://youtu.be/YE7VzlLtp-4 -->

<script>
    function buildPlayer() {
        // http://download.blender.org/peach/bigbuckbunny_movies/BigBuckBunny_320x180.mp4
		// http://video.doubleverify.com/Big-Buck-Bunny-animation-1080p-HD.mp4
		
		var contentVidUrl = 'http://download.blender.org/peach/bigbuckbunny_movies/BigBuckBunny_320x180.mp4'
		
		//Configuration="Api=0|Blocked=0|Unknown=1|BlockingServiceTimeout=5000|AllowIfTimeout=true|MovieLength=10|MovieURL=http://video.doubleverify.com/Big-Buck-Bunny-animation-1080p-HD.mp4|LoadOVV=false"
Configuration="Api=0|Blocked=0|Unknown=1|BlockingServiceTimeout=5000|AllowIfTimeout=true|MovieLength=10|MovieURL="
+ contentVidUrl
+ '|LoadOVV=false|Tag=ctx=1462413&cmp=2400648&sid=ernstandyoung&plc=1234567&num=&tagformat=2&advid=1313986&adsrv=20'
+ "&region=30&btreg=&btadsrv=&crt=&crtname=&chnl=&unit=&pid=&uid=&tagtype=video&dvtagver=6.1.src|VpaidUrl=''"

        var autoPlay = getParameterByName('autoPlay');
        if (autoPlay != "") {
            autoPlay = autoPlay.toLowerCase().indexOf( 'f' ) == -1?true:false;
        } else {
            autoPlay = true;
        }
        //var vast = $.url().param('vast');
        //if (!vast)
        var	vast =  "vast-example.xml";
        console.log('vast url: ' + vast);
        //var autoPlay = document.getElementById( 'setAutoPlay' ).value;
        flowplayer( 'player', "flowplayer/flowplayer-3.2.18.swf", {
            "clip":  {
                "autoPlay": autoPlay,
                "autoBuffering": true
            },
            "plugins": {
                "controls": {
                    "autoHide": "never"
                },
                "ova": {
                    "url": "flowplayer/ova.flowplayer/ova.swf",
                    "autoPlay": autoPlay,
                    "ads": {
                        "playOnce": false,
                        "servers": [
                            {
                                "type": "direct",
                                "tag": vast
                            }
                        ],
                        "schedule": [
                            {
                                "position": "pre-roll"
                            }
                        ]
                    }
                }
            }
        });
    }
</script>

<script src="scripts/ovvtest_core.js" type="text/javascript"></script>
<script src="scripts/ovvtest_player.js" type="text/javascript"></script>
<script  type="text/javascript">
ovvtest.setOptions({ valuesOutputElem: 'ovvParamValues'});

(function(){
	var closeBtn = document.querySelector('#ovvParamValues button.close');
	
	closeBtn.addEventListener('click', function(evt){
		var box = document.getElementById('ovvParamValues');
		box.style.display = 'none';
	});
})();

// init things
(function(){
	window.addEventListener("load", function load(event){
		window.removeEventListener("load", load, false); //remove listener, no longer needed
//		positionPlayer();
		// if (typeof(buildPlayer) === 'function') buildPlayer();
		
		ovvtest.player.setPlayer('flowplayer');
		ovvtest.player.initPlayer('player');
		
		
	},false);
})();


</script>

</body>
</html>